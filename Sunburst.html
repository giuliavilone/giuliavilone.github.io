<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Giulia Vilone - XAI</title>
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/icon" href="assets/images/favicon.ico"/>
    <!-- Font Awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Slick slider -->
    <link href="assets/css/slick.css" rel="stylesheet">
    <!-- Gallery Lightbox -->
    <link href="assets/css/magnific-popup.css" rel="stylesheet">
    <!-- Theme color -->
    <link id="switcher" href="assets/css/theme-color/default-theme.css" rel="stylesheet">

    <!-- Main Style -->
    <link href="style.css" rel="stylesheet">

    <!-- Fonts -->

    <!-- Open Sans for body font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,600,700,800" rel="stylesheet">
    <!-- Poppins for Title -->
  	<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
 
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<style>
	path {
	  stroke: #fff;
	}
	</style>
	
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
  	
  	<!-- Start Header -->
	<header id="mu-header" class="" role="banner">
		<div class="container">
			<nav class="navbar navbar-default mu-navbar">
		  <div class="container-fluid">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>

		      <!-- Text Logo -->
		      <a class="navbar-brand" href="index.html">Home</a>

		      <!-- Image Logo -->
		      <!-- <a class="navbar-brand" href="#"><img src="assets/images/logo.png"></a> -->


		    </div>
		  </div><!-- /.container-fluid -->
		</nav>
		</div>
	</header>
	<!-- End Header -->

	<!-- Start Featured Slider -->

	<section id="mu-featured-slider">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="mu-featured-area">
						<h1>Sunburst</h1>
					</div>
				</div>			
			</div>
		</div>
	</section>
	
	<!-- Start Featured Slider -->
	
	<!-- Start main content -->
		
	<main role="main">
		<script>
			let width = 1400,
				height = 1330,
				radius = (Math.min(width, height) / 2) - 10,
				node
			  
			const svg = d3.select('body')
						  .append('svg')
						  .attr('width', width)
						  .attr('height', height)
						  .append('g')
						  .attr('transform', 'translate(' + width / 2 + ',' + (height / 2) + ')')

			const x = d3.scaleLinear().range([0, 2 * Math.PI])
			const y = d3.scaleLinear().range([0, radius])

			const colors = d3.scaleOrdinal(d3.schemeCategory20c)
			const partition = d3.partition()

			const arc = d3.arc()
			  .startAngle(d => Math.max(0, Math.min(2 * Math.PI, x(d.x0))))
			  .endAngle(d => Math.max(0, Math.min(2 * Math.PI, x(d.x1))))
			  .innerRadius(d => Math.max(0, y(d.y0)))
			  .outerRadius(d => Math.max(0, y(d.y1)))

			d3.json('https://raw.githubusercontent.com/giuliavilone/literature_review/master/paper.json', function(error, root){
			  if (error) return console.error(error)

			  const gSlices = svg.selectAll('g').data(partition(d3.hierarchy(root).sum(d => 1)).descendants(), 
			  function (d) { return d.data.id }).enter().append('g')

			  gSlices.exit().remove()
			  
			  gSlices.append('path')
					 .style('fill', function (d) { 
					   if (d.depth === 0) return 'white'
					   return colors(d.x0)
					 })
					 .on('click', click)
			  
			  gSlices.append('text')
					 .attr('dy', '.35em')
					 .text(function (d) { return d.parent ? d.data.name : '' })
					 .attr('id', function (d) { return d.data.name })
					 .attr('fill', '#000')
					 .style("font-size", "11px")
					 .call(wrap, 70)

			  svg.selectAll('path')
				 .transition('update')
				 .duration(750).attrTween('d', function (d, i) {
				   return arcTweenPath(d, i)
				 })

			  svg.selectAll('text')
				 .transition('update')
				 .duration(750)
				 .attrTween('transform', function (d, i) { return arcTweenText(d, i)})
				 .attr('text-anchor', function (d) { 
				   return d.textAngle > 180 ? 'start' : 'end' 
				 })
				 .attr('dx', function (d) { 
				   return d.textAngle > 180 ? 27: 27
				 })
				 .attr('opacity', function (e) { 
				  return e.x1 - e.x0 > 0.01 ? 1 : 0 
				 })

			})

			function arcTweenText(a, i) {
			  var oi = d3.interpolate({ x0: (a.x0s ? a.x0s : 0), x1: (a.x1s ? a.x1s : 0), y0: (a.y0s ? a.y0s : 0), y1: (a.y1s ? a.y1s : 0) }, a)

			  function tween(t) {
				var b = oi(t)
				var ang = ((x((b.x0 + b.x1) / 2) - Math.PI / 2) / Math.PI * 180)

				b.textAngle = (ang > 90) ? 180 + ang : ang
				a.centroid = arc.centroid(b)

				return 'translate(' + arc.centroid(b) + ')rotate(' + b.textAngle + ')'
			  }
			  return tween
			}
			  
			function arcTweenPath(a, i) {
			  var oi = d3.interpolate({ x0: (a.x0s ? a.x0s : 0), x1: (a.x1s ? a.x1s : 0), y0: (a.y0s ? a.y0s : 0), y1: (a.y1s ? a.y1s : 0) }, a)

			  function tween(t) {
				var b = oi(t)

				a.x0s = b.x0
				a.x1s = b.x1
				a.y0s = b.y0
				a.y1s = b.y1

				return arc(b)
			  }
			  if (i == 0 && node) { 

				var xd = d3.interpolate(x.domain(), [node.x0, node.x1])
				var yd = d3.interpolate(y.domain(), [node.y0, 1])
				var yr = d3.interpolate(y.range(), [node.y0 ? 40 : 0, radius])

				return function (t) {
				  x.domain(xd(t))
				  y.domain(yd(t)).range(yr(t))

				  return tween(t)
				}
			  } else {
				// first build
				return tween
			  }
			}

			function click(d) {
			  node = d
			  const total = d.x1 - d.x0

			  svg.selectAll('path')
				 .transition('click')
				 .duration(750)
				 .attrTween('d', function (d, i) { return arcTweenPath(d, i)})

			  svg.selectAll('text')
				 .transition('click')
				 .attr('opacity', 1)
				 .duration(750)
				 .attrTween('transform', function (d, i) { 
				   return arcTweenText(d) 
				  })
				 .attr('text-anchor', function (d) { 
				   return d.textAngle > 180 ? 'start' : 'end'
				 })
				 .attr('dx', function (d) {
				   if(d.data.name.length > 3) {
					 return d.textAngle > 180 ? -23 : 23
				   }
				   return d.textAngle > 180 ? -13 : 13
				 })
				 .attr('opacity', function (e) {
				   // hide & show text
				   if (e.x0 >= d.x0 && e.x1 <= (d.x1 + 0.0000000000000001)) {
					 const arcText = d3.select(this.parentNode).select('text')
					 arcText.attr('visibility', function(d) {
					   return (d.x1 - d.x0) / total < 0.001 ? 'hidden' : 'visible' 
					 })
				   } else {
					 return 0
				   }
				 })
			 }
			
			function wrap(text, width) {
				text.each(function() {
					var text = d3.select(this),
					words = text.text().split(/\s+/).reverse(),
					word,
					line = [],
					lineNumber = 0,
					y = text.attr("y"),
					dy = parseFloat(text.attr("dy")),
					lineHeight = 1, // ems
					tspan = text.text(null).append("tspan").attr("x", function(d) { return d.children || d._children ? 0 : 10; }).attr("y", y).attr("dy", dy + "em");     
					while (word = words.pop()) {
						line.push(word);
						tspan.text(line.join(" "));
						var textWidth = tspan.node().getComputedTextLength();
						if (tspan.node().getComputedTextLength() > width) {
							line.pop();
							tspan.text(line.join(" "));
							line = [word];
							++lineNumber;
							tspan = text.append("tspan").attr("x", function(d) { return d.children || d._children ? 28 : 10; }).attr("y", 0).attr("dy", lineNumber * lineHeight + dy + "em").text(word);
						}
					}
				})
			}
				
		</script>
	</main>
	
	<!-- End main content -->	
	
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- Bootstrap -->
    <script src="assets/js/bootstrap.min.js"></script>
	<!-- Slick slider -->
    <script type="text/javascript" src="assets/js/slick.min.js"></script>
    <!-- Filterable Gallery js -->
    <script type="text/javascript" src="assets/js/jquery.filterizr.min.js"></script>
    <!-- Gallery Lightbox -->
    <script type="text/javascript" src="assets/js/jquery.magnific-popup.min.js"></script>
    <!-- Ajax contact form  -->
    <script type="text/javascript" src="assets/js/app.js"></script>
	<!-- Featured Slider -->
    <script type="text/javascript" src="assets/js/typed.min.js"></script>
    <!-- On scroll JS  -->
    <script src="assets/js/jquery.appear.js"></script>
	<!-- Progress Bar -->
    <script type="text/javascript" src="assets/js/jquery.lineProgressbar.js"></script>
	
    <!-- Custom js -->
	<script type="text/javascript" src="assets/js/custom.js"></script>
    
  </body>
</html>
